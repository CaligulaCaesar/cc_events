
namespace = dpe_contraband_event

country_event = {
	id = dpe_contraband_event.1
	title = dpe_contraband_event.1.name
	desc = dpe_contraband_event.1.desc
	
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes
	
	# mean_time_to_happen = { years = 80 }
	
	trigger = {
		years_passed > 30
		is_country_type = default
		is_authoritarian = no
		NOR = {
			has_ethic = ethic_gestalt_consciousness
			has_civic = civic_fanatic_purifiers
			has_country_flag = dpe_has_had_contraband_crisis
		}
		
		any_neighbor_country = {
			is_country_type = default
			has_faction = totalitarian
			is_materialist = no
			is_egalitarian = no
			is_synthetic_empire = no
			NOR = {
				is_same_species = root
				has_closed_borders = root
				has_ethic = ethic_gestalt_consciousness
				has_civic = civic_fanatic_purifiers
			}
			has_relation_flag = {
				who = root
				flag = dpe_comms_established
			}
			NOT = {
				has_relation_flag = {
					who = root
					flag = dpe_new_relation
				}
			}
			NOT = { has_country_flag = dpe_has_had_contraband_crisis }
		}
	}
	
	immediate = {
		random_neighbor_country = {
			limit = {
				is_country_type = default
				NOR = {
					is_materialist = yes
					is_egalitarian = yes
					has_ethic = ethic_gestalt_consciousness
					has_civic = civic_fanatic_purifiers
				}
				has_relation_flag = {
					who = root
					flag = dpe_comms_established
				}
				NOT = {
					has_relation_flag = {
						who = root
						flag = dpe_new_relation
					}
				}
				NOT = { has_country_flag = dpe_has_had_contraband_crisis }
			}
			save_event_target_as = dpe_neighbor
		}
		set_timed_country_flag = {
			flag = dpe_has_had_contraband_crisis
			years = 120
		}
	}
	
	option = {
		name = dpe_contraband_event.1.A
		
		add_modifier = {
			modifier = dpe_drug_cartels_crackdown
			years = 5
		}
		
		event_target:dpe_neighbor = {
			add_opinion_modifier = {
				modifier = dpe_cracked_down_on_drugs_opinion
				who = root
			}

			DPE_Get_Attitude = yes
		}
		
		hidden_effect = {
			event_target:dpe_neighbor = { country_event = { id = dpe_contraband_event.90 } }
			
			remove_country_flag = dpe_has_had_contraband_crisis
			set_timed_country_flag = {
				flag = dpe_has_had_contraband_crisis
				years = 40
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:dpe_neighbor = {
					OR = {
						has_defensive_pact = root
						is_in_federation_with = root
					}
				}
			}
			modifier = {
				factor = 1.5
				event_target:dpe_neighbor = {
					has_non_aggression_pact = root
				}
			}
			modifier = {
				factor = 2
				event_target:dpe_neighbor = {
					relative_power = {
						who = root
						category = fleet
						value > equivalent
					}
				}
			}
		}
	}
	
	option = {
		name = dpe_contraband_event.1.B
		
		custom_tooltip = dpe_contraband_event.1.B.tooltip
		
		add_modifier = {
			modifier = dpe_drug_cartels_tolerate
			days = -1
		}
		
		hidden_effect = {
			save_event_target_as = dpe_drugs_country
			
			event_target:dpe_neighbor = {
				set_timed_relation_flag = {
					flag = dpe_drug_cartels_ignore
					who = prev
					days = 4800
				}
				country_event = { id = dpe_contraband_event.2 days = 180 }
			}
		}

		event_target:dpe_neighbor = {
			DPE_Get_Attitude = yes
		}
		ai_chance = { factor = 1.5 }
	}
	
	option = {
		name = dpe_contraband_event.1.C
		
		custom_tooltip = dpe_contraband_event.1.C.tooltip
		
		add_modifier = {
			modifier = dpe_drug_cartels_extort
			days = -1
		}
		
		hidden_effect = {
			save_event_target_as = dpe_drugs_country
			
			set_timed_relation_flag = {
				flag = dpe_drug_cartels_extort
				who = event_target:dpe_neighbor
				days = 4800
			}
			event_target:dpe_neighbor = { country_event = { id = dpe_contraband_event.2 days = 180 } }
		}

		event_target:dpe_neighbor = {
			DPE_Get_Attitude = yes
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				event_target:dpe_neighbor = {
					OR = {
						has_defensive_pact = root
						is_in_federation_with = root
					}
				}
			}
			modifier = {
				factor = 0.75
				event_target:dpe_neighbor = {
					has_non_aggression_pact = root
				}
			}
			modifier = {
				factor = 0.5
				event_target:dpe_neighbor = {
					relative_power = {
						who = root
						category = fleet
						value > equivalent
					}
				}
			}
		}
	}
}

country_event = {
	id = dpe_contraband_event.90
	title = dpe_contraband_event.90.name
	desc = dpe_contraband_event.90.desc
	
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = {
			flag = dpe_has_had_contraband_crisis
			years = 20
		}
	}
	
	option = { name = dpe_contraband_event.90.option }
}

country_event = {
	id = dpe_contraband_event.2
	title = dpe_contraband_event.2.name
	desc = dpe_contraband_event.2.desc
	
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes
	
	
	trigger = {
		exists = from
	}
	
	immediate = {
		set_timed_country_flag = {
			flag = dpe_has_had_contraband_crisis
			years = 100
		}
	}
	
	option = {
		name = dpe_contraband_event.2.A
		
		add_modifier = {
			modifier = dpe_taxing_drugs
			months = 160
		}
		
		random_pop_faction = {
			limit = { is_pop_faction_type = totalitarian }
			add_modifier = {
				modifier = dpe_taxing_drugs_faction
				months = 160
			}
		}
		
		hidden_effect = {
			from = {
				remove_country_flag = dpe_has_had_contraband_crisis
				set_timed_country_flag = {
					flag = dpe_has_had_contraband_crisis
					years = 40
				}
				country_event = { id = dpe_contraband_event.21 }
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				has_ethic = ethic_authoritarian
			}
			modifier = {
				factor = 0
				has_ethic = ethic_fanatic_authoritarian
			}
			modifier = {
				factor = 1.5
				any_pop_faction = {
					is_pop_faction_type = totalitarian
					faction_approval < @cc_faction_high_danger_number
				}
			}
			modifier = {
				factor = 2
				any_pop_faction = {
					is_pop_faction_type = totalitarian
					support < 0.05
				}
			}
			modifier = {
				factor = 0.5
				any_pop_faction = {
					is_pop_faction_type = totalitarian
					support < 0.1
				}
			}
			modifier = {
				factor = 0.5
				any_pop_faction = {
					is_pop_faction_type = totalitarian
					support < 0.15
				}
			}
		}
	}
	
	option = {
		name = dpe_contraband_event.2.B
		
		add_modifier = {
			modifier = dpe_contraband_crisis
			days = -1
		}
		
		random_pop_faction = {
			limit = { is_pop_faction_type = totalitarian }
			add_modifier = {
				modifier = dpe_taking_action_drugs_faction
				months = 160
			}
		}
		
		hidden_effect = {
			set_timed_relation_flag = {
				flag = dpe_contraband_chain
				who = from
				days = 3600
			}

			if = {
				limit = {
					is_authoritarian = no
					has_faction = progressive
				}
				country_event = { id = dpe_contraband_event.4 days = 270 random = 180 }
			}
			else = { country_event = { id = dpe_contraband_event.45 days = 270 random = 180 } }
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				has_ethic = ethic_authoritarian
			}
			modifier = {
				factor = 5
				has_ethic = ethic_fanatic_authoritarian
			}
			modifier = {
				factor = 0.5
				any_pop_faction = {
					is_pop_faction_type = totalitarian
					support < 0.05
				}
			}
			modifier = {
				factor = 1.5
				any_pop_faction = {
					is_pop_faction_type = totalitarian
					support < 0.15
				}
			}
		}
	}
}


#Notification that drugs were legalised
country_event = {
	id = dpe_contraband_event.21
	title = dpe_contraband_event.21.name
	desc = {
		trigger = { has_modifier = dpe_drug_cartels_tolerate }
		text = dpe_contraband_event.21.desc.tolerate
	}
	desc = {
		trigger = { has_modifier = dpe_drug_cartels_extort }
		text = dpe_contraband_event.21.desc.extort
	}
	picture = GFX_evt_arguing_senate

	is_triggered_only = yes

	option = {
		name = dpe_contraband_event.21.option

		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		add_modifier = {
			modifier = dpe_drug_trade_legit
			months = 160
		}
	}
}


#Egalitarian country decides whether to do authoritarian stuff
country_event = {
	id = dpe_contraband_event.4
	title = dpe_contraband_event.4.name
	desc = dpe_contraband_event.4.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes
	
	trigger = {
		exists = fromfrom
	}

	option = {
		name = dpe_contraband_event.4.A

		random_pop_faction = {
			limit = { is_pop_faction_type = progressive }
			add_modifier = {
				modifier = dpe_contraband_stop_and_search_faction
				years = 10
			}
		}

		if = {
			limit = {
				is_egalitarian = no
			}
			custom_tooltip = dpe_contraband_event.45.tooltip
	
			hidden_effect = {
				every_owned_pop = {
					limit = {
						has_citizenship_rights = yes
						NOT = { has_ethic = ethic_authoritarian }
						pop_has_happiness = yes
					}
					pop_event = { id = dpe_contraband_event.46 }
				}
			}
		}
		hidden_effect = {
			country_event = { id = dpe_contraband_event.50 days = 270 random = 720 }
		}

		ai_chance = {
			factor = 1.67
			modifier = {
				factor = 0.5
				has_ethic = ethic_egalitarian
			}
			modifier = {
				factor = 0.33
				has_ethic = ethic_fanatic_egalitarian
			}
			modifier = {
				factor = 0.5
				is_egalitarian = no
				any_pop_faction = {
					is_pop_faction_type = progressive
					support > 0.15
				}
			}
			modifier = {
				factor = 0.5
				any_pop_faction = {
					is_pop_faction_type = progressive
					support > 0.33
				}
			}
		}
	}

	option = {
		name = dpe_contraband_event.4.B
		custom_tooltip = dpe_contraband_event.4.B.tooltip

		hidden_effect = {
			country_event = { id = dpe_contraband_event.505 days = 480 random = 2160 }
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.33
				any_pop_faction = {
					is_pop_faction_type = progressive
					support < 0.08
				}
			}
		}
	}
}



#Authoritarian country decides whether to do authoritarian stuff
country_event = {
	id = dpe_contraband_event.45
	title = dpe_contraband_event.45.name
	desc = dpe_contraband_event.45.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes
	
	trigger = {
		exists = fromfrom
	}

	option = {
		name = OK
		custom_tooltip = dpe_contraband_event.45.tooltip

		hidden_effect = {
			every_owned_pop = {
				limit = {
					has_citizenship_rights = yes
					NOT = { has_ethic = ethic_authoritarian }
					pop_has_happiness = yes
				}
				pop_event = { id = dpe_contraband_event.46 }
			}
		}

		if = {
			limit = { has_faction = progressive }
			random_pop_faction = {
				limit = { is_pop_faction_type = progressive }
				add_modifier = {
					modifier = dpe_contraband_stop_and_search_faction
					years = 10
				}
			}
		}

		hidden_effect = {
			country_event = { id = dpe_contraband_event.50 days = 270 random = 720 }
		}
	}
}

pop_event = {
	id = dpe_contraband_event.46
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			1 = {
				add_modifier = {
					modifier = dpe_raids_worry
					years = 5
				}
			}
			4 = { }
		}
	}
}


country_event = {
	id = dpe_contraband_event.50
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:dpe_drugs_country
	}

	immediate = {
		if = {
			limit = { has_closed_borders = event_target:dpe_drugs_country }
			country_event = { id = dpe_contraband_event.900 }
			event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.901 } }
		}
		else_if = {
			limit = { event_target:dpe_drugs_country = { has_modifier = dpe_drug_cartels_tolerate } }
			country_event = { id = dpe_contraband_event.54 days = 480 random = 2160 }
		}
		else = { country_event = { id = dpe_contraband_event.52 days = 480 random = 2160 } }
	}
}

country_event = {
	id = dpe_contraband_event.505
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:dpe_drugs_country
	}

	immediate = {
		if = {
			limit = { has_closed_borders = event_target:dpe_drugs_country }
			country_event = { id = dpe_contraband_event.900 }
			event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.901 } }
		}
		else_if = {
			limit = { event_target:dpe_drugs_country = { has_modifier = dpe_drug_cartels_tolerate } }
			country_event = { id = dpe_contraband_event.53 days = 270 random = 720 }
		}
		else = { country_event = { id = dpe_contraband_event.51 days = 270 random = 720 } }
	}
}


#Extort + search homes
country_event = {
	id = dpe_contraband_event.51
	title = dpe_contraband_event.51.name
	desc = dpe_contraband_event.51.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	trigger = {
		exists = event_target:dpe_drugs_country
	}

	immediate = {
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
	}

	option = {
		name = dpe_contraband_event.51.A

		remove_modifier = dpe_contraband_crisis
		if = {
			limit = { NOT = { has_closed_borders = event_target:dpe_drugs_country } }
			set_closed_borders = {
				who = event_target:dpe_drugs_country
				status = yes
			}
		}
		event_target:dpe_drugs_country = {
			add_opinion_modifier = {
				modifier = dpe_contraband_closed_borders
				who = root
			}
			hidden_effect = {
				add_opinion_modifier = {
					modifier = dpe_contraband_closed_borders
					who = root
				}
			}
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
		hidden_effect = {
			add_opinion_modifier = {
				modifier = dpe_contraband_source_of_drugs
				who = event_target:dpe_drugs_country
			}
		}
		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.61 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 1.5
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 2
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				is_xenophobe = yes
			}
			modifier = {
				factor = 0.5
				relative_power = {
					who = event_target:dpe_drugs_country
					value < equivalent
				}
			}
		}
	}

	option = {
		name = dpe_contraband_event.51.B
		custom_tooltip = dpe_contraband_event.51.B.tooltip

		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.62 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 0.75
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 0.5
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				OR = {
					is_pacifist = yes
					is_xenophile = yes
				}
			}
		}
	}
}


#Extort + don't search homes
country_event = {
	id = dpe_contraband_event.52
	title = dpe_contraband_event.52.name
	desc = dpe_contraband_event.52.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	trigger = {
		exists = event_target:dpe_drugs_country
	}

	immediate = {
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
	}

	option = {
		name = dpe_contraband_event.52.A
		custom_tooltip = dpe_contraband_event.52.A.tooltip

		remove_modifier = dpe_contraband_crisis

		add_monthly_resource_mult = {
			resource = minerals
			value = 6
			min = 120
			max = 2000
		}
		if = {
			limit = { NOT = { has_closed_borders = event_target:dpe_drugs_country } }
			set_closed_borders = {
				who = event_target:dpe_drugs_country
				status = yes
			}
		}
		event_target:dpe_drugs_country = {
			add_opinion_modifier = {
				modifier = dpe_contraband_closed_borders
				who = root
			}
			hidden_effect = {
				add_opinion_modifier = {
					modifier = dpe_contraband_closed_borders
					who = root
				}
			}
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
		hidden_effect = {
			add_opinion_modifier = {
				modifier = dpe_contraband_source_of_drugs
				who = event_target:dpe_drugs_country
			}
		}
		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.63 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 1.5
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 2
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				is_xenophobe = yes
			}
			modifier = {
				factor = 0.5
				relative_power = {
					who = event_target:dpe_drugs_country
					value < equivalent
				}
			}
		}
	}

	option = {
		name = dpe_contraband_event.52.B
		custom_tooltip = dpe_contraband_event.52.B.tooltip

		remove_modifier = dpe_contraband_crisis

		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.64 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 0.75
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 0.5
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				relative_power = {
					who = event_target:dpe_drugs_country
					value < equivalent
				}
			}
		}
	}

	option = {
		name = dpe_contraband_event.52.C
		
		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.62 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 0.75
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 0.5
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				OR = {
					is_pacifist = yes
					is_xenophile = yes
				}
			}
		}
	}
}


#Tolerate + search homes
country_event = {
	id = dpe_contraband_event.53
	title = dpe_contraband_event.53.name
	desc = dpe_contraband_event.53.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	trigger = {
		exists = event_target:dpe_drugs_country
	}

	immediate = {
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
	}
	
	option = {
		name = dpe_contraband_event.53.A

		remove_modifier = dpe_contraband_crisis
		if = {
			limit = { NOT = { has_closed_borders = event_target:dpe_drugs_country } }
			set_closed_borders = {
				who = event_target:dpe_drugs_country
				status = yes
			}
		}
		event_target:dpe_drugs_country = {
			add_opinion_modifier = {
				modifier = dpe_contraband_closed_borders
				who = root
			}
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.66 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 1.5
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 2
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				is_xenophobe = yes
			}
			modifier = {
				factor = 0.5
				relative_power = {
					who = event_target:dpe_drugs_country
					value < equivalent
				}
			}
		}
	}

	
	option = {
		name = dpe_contraband_event.53.B
		custom_tooltip = dpe_contraband_event.53.B.tooltip

		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.68 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 0.75
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 0.5
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				OR = {
					is_pacifist = yes
					is_xenophile = yes
				}
			}
		}
	}
}


#Tolerate + didn't search homes
country_event = {
	id = dpe_contraband_event.54
	title = dpe_contraband_event.54.name
	desc = dpe_contraband_event.54.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	trigger = {
		exists = event_target:dpe_drugs_country
	}
	
	option = {
		name = dpe_contraband_event.54.A

		remove_modifier = dpe_contraband_crisis
		if = {
			limit = { NOT = { has_closed_borders = event_target:dpe_drugs_country } }
			set_closed_borders = {
				who = event_target:dpe_drugs_country
				status = yes
			}
		}
		event_target:dpe_drugs_country = {
			add_opinion_modifier = {
				modifier = dpe_contraband_closed_borders
				who = root
			}
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.69 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.5
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 1.5
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 2
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				is_xenophobe = yes
			}
			modifier = {
				factor = 0.5
				relative_power = {
					who = event_target:dpe_drugs_country
					value < equivalent
				}
			}
		}
	}

	
	option = {
		name = dpe_contraband_event.54.B
		
		hidden_effect = { event_target:dpe_drugs_country = { country_event = { id = dpe_contraband_event.68 } } }
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				OR = {
					is_cordial_to = event_target:dpe_drugs_country
					is_friendly_to = event_target:dpe_drugs_country
					is_loyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 0.75
				is_unfriendly_to = event_target:dpe_drugs_country
			}
			modifier = {
				factor = 0.5
				OR = {
					is_hostile_to = event_target:dpe_drugs_country
					is_domineering_to = event_target:dpe_drugs_country
					is_rival = event_target:dpe_drugs_country
					is_unfriendly_to = event_target:dpe_drugs_country
					is_disloyal_to = event_target:dpe_drugs_country
				} 
			}
			modifier = {
				factor = 2
				OR = {
					is_pacifist = yes
					is_xenophile = yes
				}
			}
		}
	}
}



#6th events

country_event = {
	id = dpe_contraband_event.61
	title = dpe_contraband_event.61.name
	desc = dpe_contraband_event.61.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.61.option

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		tooltip = {
			from = {
				set_closed_borders = {
					who = root
					status = yes
				}
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = root
				}
			}
		}

		custom_tooltip = dpe_deceitful_diplomacy
		hidden_effect = {
			every_country = {
				limit = {
					has_communications = root
					has_communications = from
					NOR = {
						is_same_value = from
						is_same_value = root
					}
				}
				add_opinion_modifier = {
					modifier = dpe_deceitful
					who = root
				}
				if = {
					limit = {
						OR = {
							has_defensive_pact = from
							is_in_federation_with = from
						}
					}
					add_opinion_modifier = {
						modifier = dpe_deceitful
						who = root
					}
				}
			}
		}
	}
}

country_event = {
	id = dpe_contraband_event.62
	title = dpe_contraband_event.62.name
	desc = dpe_contraband_event.62.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.62.A

		hidden_effect = { from = { country_event = { id = dpe_contraband_event.621 days = 5 } } }

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		ai_chance = { factor = 1 }
	}

	option = {
		name = dpe_contraband_event.62.B
		custom_tooltip = dpe_contraband_event.62.B.tooltip

		hidden_effect = { from = { country_event = { id = dpe_contraband_event.622 days = 5 } } }

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		tooltip = {
			from = {
				set_closed_borders = {
					who = root
					status = yes
				}
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = root
				}
			}
		}

		custom_tooltip = dpe_deceitful_diplomacy
		hidden_effect = {
			every_country = {
				limit = {
					has_communications = root
					has_communications = from
					NOR = {
						is_same_value = from
						is_same_value = root
					}
				}
				add_opinion_modifier = {
					modifier = dpe_deceitful
					who = root
				}
				if = {
					limit = {
						OR = {
							has_defensive_pact = from
							is_in_federation_with = from
						}
					}
					add_opinion_modifier = {
						modifier = dpe_deceitful
						who = root
					}
				}
			}
		}
		ai_chance = { factor = 0 }
	}
}

country_event = {
	id = dpe_contraband_event.621
	title = dpe_contraband_event.621.name
	desc = dpe_contraband_event.621.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.621.A

		remove_modifier = dpe_contraband_crisis

		add_opinion_modifier = {
			who = from
			modifier = dpe_cracked_down_on_drugs_opinion
		}
	}
}

country_event = {
	id = dpe_contraband_event.622
	title = dpe_contraband_event.622.name
	desc = dpe_contraband_event.622.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.622.A

		remove_modifier = dpe_contraband_crisis

		set_closed_borders = {
			who = from
			status = yes
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = from
		}
		hidden_effect = {
			add_opinion_modifier = {
				modifier = dpe_contraband_source_of_drugs
				who = from
			}
		}
		from = {
			add_opinion_modifier = {
				modifier = dpe_contraband_closed_borders
				who = from
			}
			hidden_effect = {
				add_opinion_modifier = {
					modifier = dpe_contraband_closed_borders
					who = from
				}
			}
		}
	}
}


country_event = {
	id = dpe_contraband_event.63
	title = dpe_contraband_event.63.name
	desc = dpe_contraband_event.63.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.63.option

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		tooltip = {
			from = {
				set_closed_borders = {
					who = root
					status = yes
				}
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = root
				}
			}
		}
	}
}



country_event = {
	id = dpe_contraband_event.64
	title = dpe_contraband_event.64.name
	desc = dpe_contraband_event.64.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.64.A

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		ai_chance = { factor = 1 }
	}

	option = {
		name = dpe_contraband_event.64.B
		custom_tooltip = dpe_contraband_event.64.B.tooltip

		hidden_effect = { from = { country_event = { id = dpe_contraband_event.641 days = 5 } } }

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		ai_chance = { factor = 0 }
	}
}


country_event = {
	id = dpe_contraband_event.641
	title = dpe_contraband_event.641.name
	desc = dpe_contraband_event.641.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.641.A

		remove_modifier = dpe_contraband_crisis

		set_closed_borders = {
			who = from
			status = yes
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = from
		}
		from = {
			add_opinion_modifier = {
				modifier = dpe_contraband_closed_borders
				who = from
			}
		}
		hidden_effect = { from = { country_event = { id = dpe_contraband_event.642 } } }
	}
}


country_event = {
	id = dpe_contraband_event.642
	title = dpe_contraband_event.642.name
	desc = dpe_contraband_event.642.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = UNFORTUNATE

		tooltip = {
			from = {
				set_closed_borders = {
					who = root
					status = yes
				}
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = root
				}
			}
		}
	}
}

country_event = {
	id = dpe_contraband_event.66
	title = dpe_contraband_event.66.name
	desc = dpe_contraband_event.66.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.66.option

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		tooltip = {
			from = {
				set_closed_borders = {
					who = root
					status = yes
				}
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = root
				}
			}
		}
	}
}





country_event = {
	id = dpe_contraband_event.68
	title = dpe_contraband_event.68.name
	desc = dpe_contraband_event.68.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.68.A

		hidden_effect = { from = { country_event = { id = dpe_contraband_event.621 days = 5 } } }

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		ai_chance = { factor = 1 }
	}

	option = {
		name = dpe_contraband_event.68.B
		custom_tooltip = dpe_contraband_event.68.B.tooltip

		hidden_effect = { from = { country_event = { id = dpe_contraband_event.682 days = 5 } } }

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		tooltip = {
			from = {
				set_closed_borders = {
					who = root
					status = yes
				}
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = root
				}
			}
		}
		ai_chance = { factor = 0 }
	}
}


country_event = {
	id = dpe_contraband_event.682
	title = dpe_contraband_event.682.name
	desc = dpe_contraband_event.682.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.682.A

		remove_modifier = dpe_contraband_crisis

		set_closed_borders = {
			who = from
			status = yes
		}
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = from
		}
		from = {
			add_opinion_modifier = {
				modifier = dpe_contraband_closed_borders
				who = from
			}
		}
	}
}

country_event = {
	id = dpe_contraband_event.69
	title = dpe_contraband_event.69.name
	desc = dpe_contraband_event.69.desc

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}

	option = {
		name = dpe_contraband_event.69.option

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
		tooltip = {
			from = {
				set_closed_borders = {
					who = root
					status = yes
				}
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = root
				}
			}
		}
	}
}


#Borders closed for importer
country_event = {
	id = dpe_contraband_event.900
	title = dpe_contraband_event.900.title
	desc = dpe_contraband_event.900.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	immediate = {
		add_opinion_modifier = {
			modifier = dpe_contraband_source_of_drugs
			who = event_target:dpe_drugs_country
		}
	}

	option = {
		name = dpe_contraband_event.900.option

		remove_modifier = dpe_contraband_crisis
	}
}

#Borders closed for exporter
country_event = {
	id = dpe_contraband_event.901
	title = dpe_contraband_event.901.title
	desc = dpe_contraband_event.901.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE

		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}

		tooltip = {
			from = {
				add_opinion_modifier = {
					modifier = dpe_contraband_source_of_drugs
					who = event_target:dpe_drugs_country
				}
			}
		}
	}
}




#on_country_destroyed
country_event = {
	id = dpe_contraband_event.998
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			AND = {
				has_modifier = dpe_contraband_crisis
				any_country = {
					root = {
						has_relation_flag = {
							who = prev
							flag = dpe_drug_cartels_ignore
						}
					}
				}
			}
			any_country = {
				has_modifier = dpe_contraband_crisis
				has_relation_flag = {
					who = root
					flag = dpe_drug_cartels_ignore
				}
			}
		}
	}

	immediate = {
		if = {
			limit = {
				any_country = {
					has_modifier = dpe_contraband_crisis
					has_relation_flag = {
						who = root
						flag = dpe_drug_cartels_ignore
					}
				}
			}
			random_country = {
				limit = {
					has_modifier = dpe_contraband_crisis
					has_relation_flag = {
						who = root
						flag = dpe_drug_cartels_ignore
					}
				}
				country_event = { id = dpe_contraband_event.999 }
			}
		}

		else = {
			random_country = {
				limit = {
					root = {
						has_relation_flag = {
							who = prev
							flag = dpe_drug_cartels_ignore
						}
					}
				}
				country_event = { id = dpe_contraband_event.9991 }
			}
		}
	}
}

country_event = {
	id = dpe_contraband_event.999
	title = dpe_contraband_event.999.name
	desc = dpe_contraband_event.999.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	option = {
		name = dpe_contraband_event.999.option
		remove_modifier = dpe_contraband_crisis
	}
}


country_event = {
	id = dpe_contraband_event.9991
	title = dpe_contraband_event.9991.name
	desc = dpe_contraband_event.9991.desc
	picture = GFX_evt_smugglers_in_bar

	is_triggered_only = yes

	immediate = {
		remove_country_flag = dpe_has_had_contraband_crisis
		set_timed_country_flag = {
			flag = dpe_has_had_contraband_crisis
			years = 10
		}
	}

	option = {
		name = dpe_contraband_event.9991.option
		if = {
			limit = { has_modifier = dpe_drug_cartels_extort }
			remove_modifier = dpe_drug_cartels_extort
		}
		if = {
			limit = { has_modifier = dpe_drug_cartels_tolerate }
			remove_modifier = dpe_drug_cartels_tolerate
		}
	}
}