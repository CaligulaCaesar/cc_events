
namespace = cctest


country_event = {
	id = cctest.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		remove_country_flag = dpe_xenomission_disaster
	}
}


country_event = {
	id = cctest.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_system_within_border = {
			random_fleet_in_system = {
				limit = {
					any_owned_ship = {
						is_ship_class = shipclass_starbase
					}
				}
				add_modifier = {
					modifier = dpe_starbase_talented_admiral
					days = 10800
				}
			}
		}
	}
}



country_event = {
	id = cctest.4
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				has_federation = yes
				is_country_type = default
			}
			join_war = root
		}
	}
}

country_event = {
	id = cctest.5
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = { 
				is_country_type = default
			}
			join_alliance = {
				who = root
				name = NAME_League_of_Non-Aligned_Powers
				override_requirements = yes
			}
		}
	}
}

country_event = {
	id = cctest.6
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = { 
				is_country_type = default
				is_at_war = yes
			}
			root = { join_war = prev }
		}
	}
}



country_event = {
	id = cctest.65
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				opinion = {
					who = root
					value < 100
				}
			}
			root = { country_event = { id = cctest.10 } }
		}
	}
}

country_event = {
	id = cctest.7
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				opinion = {
					who = root
					value < -1
				}
			}
			root = { country_event = { id = cctest.10 } }
		}
	}
}

country_event = {
	id = cctest.8
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				opinion = {
					who = root
					value < -50
				}
			}
			root = { country_event = { id = cctest.10 } }
		}
	}
}

country_event = {
	id = cctest.10
	title = OK
	desc = OK
	
	picture = GFX_evt_arguing_senate
	
	is_triggered_only = yes
	
	option = {
		name = OK
		
		trigger = { is_ai = no }
		allow = { is_ai = no }
	}
	option = {
		name = GOOD
		
		trigger = { is_ai = yes }
		allow = { is_ai = yes }
	}
	option = {
		name = UNFORTUNATE
		
		allow = { is_ai = no }
	}
	option = {
		name = EXCELLENT
		
		allow = { is_ai = yes }
	}
}



country_event = {
	id = cctest.20
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {

		create_leader = {
			type = scientist
			species = owner_main_species
			name = random
			skill = 5
			traits = {
				trait = leader_trait_maniacal
				trait = dpe_leader_trait_ancient_knowledge
			}
		}
		last_created_leader = {
			save_event_target_as = dpe_escaped_scientist
			if = {
				limit = {
					species = { NOT = { has_trait = trait_erudite } }
				}
				modify_species = {
					add_trait = trait_erudite
				}
				add_trait = leader_trait_scientist_erudite
				add_ruler_trait = leader_trait_ruler_erudite
			}
		}
	}
}


country_event = {
	id = cctest.21
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		country_event = { id = cctest.22 days = 10 }
	}
}
country_event = {
	id = cctest.22
	title = OK
	desc = OK
	is_triggered_only = yes
	picture = GFX_evt_arguing_senate
	
	option = {
		name = OK
		
	}
	option = {
		name = OK
		allow = { NOT = { has_ethic = ethic_fanatic_spiritualist } }
		
		
		country_event = { id = cctest.10 days = 10 }
	}
}





country_event = {
	id = cctest.35
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		capital_scope = {
			set_variable = {
				which = cc_opinion_test
				value = 0
			}
			set_variable = {
				which = cc_opinion_bug_test
				value = 0
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						opinion = {
							who = root
							value < 100
						}
					}
				}
				change_variable = {
					which = cc_opinion_test
					value = 10
				}
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						opinion = {
							who = root
							value < 50
						}
					}
				}
				change_variable = {
					which = cc_opinion_test
					value = 10
				}
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						opinion = {
							who = root
							value < 0
						}
					}
				}
				change_variable = {
					which = cc_opinion_test
					value = 10
				}
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						opinion = {
							who = root
							value < -50
						}
					}
				}
				change_variable = {
					which = cc_opinion_test
					value = 10
				}
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						opinion = {
							who = root
							value < -100
						}
					}
				}
				change_variable = {
					which = cc_opinion_test
					value = 10
				}
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						NOT = {
							opinion = {
								who = root
								value > -50
							}
						}
					}
				}
				change_variable = {
					which = cc_opinion_test
					value = 10
				}
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						opinion = {
							who = root
							value > -50
						}
					}
				}
				change_variable = {
					which = cc_opinion_bug_test
					value = 10
				}
			}
			if = {
				limit = {
					any_country = {
						is_country_type = default
						NOT = { is_same_value = root }
						opinion = {
							who = root
							value > 100
						}
					}
				}
				change_variable = {
					which = cc_opinion_bug_test
					value = 10
				}
			}
		}
	}
}



country_event = {
	id = cctest.40
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		while = {
			count = 100
			country_event = { id = cctest.10 days = 10 random = 9 }
		}
	}
}


country_event = {
	id = cctest.50
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		root.capital_scope = {
			set_variable = {
				which = cctest_factions_variable
				value = 1
			}
		}
		random_pop_faction = {
			limit = { is_pop_faction_type = prosperity }
			save_event_target_as = prosperity_faction
		}
#		random_owned_leader = {
#			limit = { leader_of_faction = prosperity }
#			root.capital_scope = {
#				change_variable = {
#					which = cctest_factions_variable
#					value = 1
#				}
#			}
#		}
#		random_owned_leader = {
#			limit = { leader_of_faction = yes }
#			root.capital_scope = {
#				change_variable = {
#					which = cctest_factions_variable
#					value = 1
#				}
#			}
#		}
#		random_owned_leader = {
#			limit = { leader_of_faction = no }
#			root.capital_scope = {
#				change_variable = {
#					which = cctest_factions_variable
#					value = 1
#				}
#			}
#		}
#		random_owned_leader = {
#			limit = { leader_of_faction = event_target:prosperity_faction }
#			root.capital_scope = {
#				change_variable = {
#					which = cctest_factions_variable
#					value = 1
#				}
#			}
#		}
	}
}


country_event = {
	id = cctest.55
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { 
				any_war = { is_war_participant = { who = root } }
			}
			root.capital_scope = {
				set_variable = {
					which = cctest_war_variable
					value = 10
				}
			}
		}
	}
}



country_event = {
	id = cctest.60
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		root.capital_scope = {
			set_variable = {
				which = cctest_member_faction_variable
				value = 1
			}
		}
		random_pop_faction = {
			limit = { is_pop_faction_type = prosperity }
			save_event_target_as = prosperity_faction
		}
#		random_owned_pop = {
#			limit = { member_of_faction = prosperity }
#			root.capital_scope = {
#				change_variable = {
#					which = cctest_member_faction_variable
#					value = 1
#				}
#			}
#		}
		random_owned_pop = {
			limit = { member_of_faction = yes }
			root.capital_scope = {
				change_variable = {
					which = cctest_member_faction_variable
					value = 1
				}
			}
		}
		random_owned_pop = {
			limit = { member_of_faction = no }
			root.capital_scope = {
				change_variable = {
					which = cctest_member_faction_variable
					value = 1
				}
			}
		}
#		random_owned_pop = {
#			limit = { member_of_faction = event_target:prosperity_faction }
#			root.capital_scope = {
#				change_variable = {
#					which = cctest_member_faction_variable
#					value = 1
#				}
#			}
#		}
	}
}


planet_event = {
	id = cctest.70
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		owner = {
			create_leader = {
				type = general
				species = root.owner_species
				name = random
				skill = 1
			}
		}
		root.owner_species = {
			mutate_species = yes
		}
	}
}


planet_event = {
	id = cctest.80
	hide_window = yes
	is_triggered_only = yes
	
	
	immediate = {
		owner = {
			if = {
				limit = {
					pop_percentage = {
						limit = {
							is_same_species = root.owner
							log = [this.GetName]
							log = [planet.GetName]
						}
						percentage > 0.1
					}
				}
			}
			
			root = {
				if = {
					limit = {
						count_pops = {
							limit = {
								is_same_species = prevprev
								log = this
							}
							count > 3
						}
					}
					set_variable = {
						which = cctest_count_pops_1
						value = 10
					}
				}
				if = {
					limit = {
						count_pops = {
							limit = {
								is_same_species = prev
								log = [this.GetName]
								log = [this.planet.GetName]
								log = [prev.GetName]
								log = [planet.GetName]
								log = [owner.GetName]
							}
							count > 3
						}
					}
					set_variable = {
						which = cctest_count_pops_2
						value = 10
					}
				}
				if = {
					limit = {
						count_pops = {
							limit = {
								is_same_species = this
							}
							count > 3
						}
					}
					set_variable = {
						which = cctest_count_pops_3
						value = 10
					}
				}
			}
		}
	}
}


country_event = {
	id = cctest.90
	hide_window = yes
	is_triggered_only = yes
	
	
	immediate = {
		if = {
			limit = {
				count_pop_factions = {
					limit = {
						is_pop_faction_type = progressive
					}
					count = 1
				}
			}
			capital_scope = {
				change_variable = {
					which = cctest_count_faction_variable
					value = 1
				}
			}
		}
		if = {
			limit = {
				count_pop_factions = {
					limit = {
						pop_percentage = {
							percentage > 0
							limit = { is_same_species = root }
						}
						is_pop_faction_type = progressive
					}
					count = 1
				}
			}
			capital_scope = {
				change_variable = {
					which = cctest_count_faction_variable
					value = 1
				}
			}
		}
	}
}


country_event = {
	id = cctest.95
	hide_window = yes
	is_triggered_only = yes
	
	
	immediate = {
		if = {
			limit = {
				any_owned_pop = {
					is_robot_pop = yes
				}
			}
			capital_scope = {
				change_variable = {
					which = cctest_robot_pop_yes
					value = 1
				}
			}
		}
		if = {
			limit = {
				any_owned_pop = {
					is_robot_pop = no
				}
			}
			capital_scope = {
				change_variable = {
					which = cctest_robot_pop_no
					value = 1
				}
			}
		}
	}
}


country_event = {
	id = cctest.99
	hide_window = yes
	is_triggered_only = yes
	
	
	immediate = {
		create_leader = {
			species = root
			traits = {
				add_trait = dpe_leader_trait_ancient_knowledge
			}
			type = scientist
		}
		create_fleet = {
			effect = {
				set_owner = root
				while = {
					count = 20 
					create_army_transport = {
						ship_name = "NAME_Pirate_Transport"
						army_type = "assault_army"
						species = root
					}
				}
				set_location = {
					target = root.capital_scope
					distance = 45
					angle = random
				}
			}
		}
	}
}

country_event = {
	id = cctest.200
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		random_playable_country = {
			country_event = { id = cctest.201 }
		}
	}
}


country_event = {
	id = cctest.201
	is_triggered_only = yes
	hide_window = yes	
	immediate = {
		capital_scope = {
			change_variable = {
				which = dpe_froms_test
				value = 1
			}
		}
		if = {
			limit = {
				capital_scope = {
					check_variable = {
						which = dpe_froms_test
						value = 1000
					}
				}
			}
			break = yes
		}
		from = { country_event = { id = cctest.201 } }
	}
}
		
		

country_event = {
	id = cctest.300
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		if = {
			limit = {
				any_country = {
					has_relation_flag = {
						flag = dpe_test
						who = root
					}
				}
			}
		}
	}
}

country_event = {
	id = cctest.301
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		if = {
			limit = {
				any_country = {
					has_relation_flag = {
						flag = dpe_test
						who = from
					}
				}
			}
		}
	}
}

country_event = {
	id = cctest.302
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		set_country_flag = dpe_test@prevprevprevprev
	}
}

country_event = {
	id = cctest.303
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		set_relation_flag = {
			flag = dpe_test
			who = prevprevprevprev
		}
	}
}

country_event = {
	id = cctest.304
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		set_relation_flag = {
			flag = dpe_test
			who = event_target:doesnt_exist
		}
	}
}


country_event = {
	id = cctest.306
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		set_relation_flag = {
			flag = dpe_test
			who = root
		}
		if = {
			limit = {
				any_country = {
					has_relation_flag = {
						flag = dpe_test
						who = root
					}
				}
			}
			log = "Idiot"
		}
	}
}




country_event = {
	id = cctest.400
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		create_fleet = {
			effect = {
				set_owner = root
				set_location = root.capital_scope
				create_ship = {
					name = random
					design = "NAME_Pirate_Hideout"
					graphical_culture = "pirate_01"
				}
				create_ship = {
					name = random
					design = "Small Crystal Entity Blue"
					graphical_culture = "pirate_01"
				}
			}
		}
	}
}




country_event = {
	id = cctest.500
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		if = {
			limit = {
				capital_scope = {
					habitability = {
						who = root
						value > 0.6
					}
				}
			}
			change_variable = {
				which = cctest_habitability_1
				value = 1
			}
		}
		if = {
			limit = {
				NOT = {
					any_playable_country = {
						NOT = { has_ethic = ethic_gestalt_consciousness }
						capital_scope = {
							habitability = {
								who = root
								value < 0.95
							}
						}
					}
				}
			}
			change_variable = {
				which = cctest_habitability_2
				value = 1
			}
		}
	}
}


country_event = {
	id = cctest.600
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		capital_scope.solar_system = {
			spawn_megastructure = {
				type = lgate_base
				orbit_angle = 0
				orbit_distance = 100
			}
			
			spawn_megastructure = {
				type = lgate_base
				random_pos = yes
			}
		}
	}
}


###This works perfectly :)
country_event = {
	id = cctest.700
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		random_playable_country = {
			limit = {
				NOT = {
					is_same_value = root
				}
			}
			save_event_target_as = cctest_country
			log = [this.GetName]
		}
		
		while = {
			count = 10
			random_owned_leader = {
				save_event_target_as = dpe_defect_leader
			}
			create_fleet = {
				name = "NAME_Other_Science_Ship"
				effect = {
					set_owner = root
					create_ship_design = {
						design = "NAME_Prototype"
					}
					create_ship = {
						name = "NAME_From_Beyond"
						design = last_created_design
						graphical_culture = "extra_dimensional_01"
						prefix = no
						upgradable = no
					}
					set_location = root.capital_scope
					save_event_target_as = deleted_ship
				}
			}
			event_target:deleted_ship = {
				set_leader = event_target:dpe_defect_leader
				leader = { exile_leader_as = dpe_defect_leader }
				delete_fleet = this
			}
			
			create_fleet = {
				name = "NAME_Other_Science_Ship"
				effect = {
					set_owner = event_target:cctest_country
					create_ship_design = {
						design = "NAME_Prototype"
					}
					create_ship = {
						name = "NAME_From_Beyond"
						design = last_created_design
						graphical_culture = "extra_dimensional_01"
						prefix = no
						upgradable = no
					}
					set_location = event_target:cctest_country.capital_scope
					save_event_target_as = deleted_ship
				}
			}
			event_target:deleted_ship = {
				set_leader = dpe_defect_leader
				leader = { unassign_leader = this }
				delete_fleet = this
			}
		}
	}
}





country_event = {
	id = cctest.750
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				any_war = {
					is_war_participant = {
						who = root
					}
					defender_war_exhaustion > 0
				}
			}
			capital_scope = {
				set_variable = {
					which = ccwarexhtest1
					value = 1
				}
			}
		}
		if = {
			limit = {
				any_war = {
					is_war_participant = {
						who = root
					}
					defender_war_exhaustion > 1
				}
			}
			capital_scope = {
				set_variable = {
					which = ccwarexhtest2
					value = 1
				}
			}
		}
	}
}


country_event = {
	id = cctest.751
	is_triggered_only = yes
	title = OK
	desc = OK
	picture = GFX_evt_aggressive_flora

	immediate = {
		random_playable_country = {
			establish_communications_no_message = root
			save_event_target_as = cctest_country
		}

		create_leader = {
			name = random
			type = random
			species = event_target:cctest_country.species
		}
		country_event = { id = dpe_defect_leader.1 }
		country_event = { id = cctest.752 days = 2 }
	}
	option = {
		name = OUR_SIDE
	}
	option = {
		name = THEIR_SIDE
		set_player = event_target:cctest_country
	}
}

country_event = {
	id = cctest.752
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		remove_country_flag = dpe_recent_defect_leader
		event_target:cctest_country = {
			remove_country_flag = dpe_recent_defect_leader
		}
	}
}


country_event = {
	id = cctest.753
	title = OK
	desc = OK
	picture = GFX_evt_aggressive_flora
	is_triggered_only = yes

	immediate = {
		random_playable_country = {
			limit = {
				has_authority = auth_hive_mind
			}
			establish_communications_no_message = root
			save_event_target_as = cctest_country
		}
		country_event = {
			id = cctest.754
			days = 1
		}
	}
	option = {
		name = OUR_SIDE
	}
	option = {
		name = THEIR_SIDE
		set_player = event_target:cctest_country
	}
}


country_event = {
	id = cctest.754
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				NOT = {
					has_global_flag = mem_hive_encounter_happened
				}
			}
			country_event = { id = mem_hive_encounter.1 }
			country_event = {
				id = cctest.754
				days = 1
			}
		}
	}
}